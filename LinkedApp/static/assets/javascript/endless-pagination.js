(function(d){d.fn.endlessPaginate=function(c){var a=d.extend({containerSelector:".endless_container",loadingSelector:".endless_loading",moreSelector:"a.endless_more",pageSelector:".endless_page_template",pagesSelector:"a.endless_page_link",onClick:function(){},onCompleted:function(){},paginateOnScroll:!1,paginateOnScrollMargin:1,paginateOnScrollChunkSize:0},c),k=function(a){return{key:a.attr("rel").split(" ")[0],url:a.attr("href")}};return this.each(function(){var c=d(this),g=1;c.on("click",a.moreSelector,
function(){var b=d(this),c=b.get(0),e=b.closest(a.containerSelector),l=e.find(a.loadingSelector);if(l.is(":visible"))return!1;b.hide();l.show();var f=k(b);!1!==a.onClick.apply(c,[f])&&d.get(f.url,"querystring_key="+f.key,function(b){e.before(b);e.remove();g+=1;a.onCompleted.apply(c,[f,b.trim()])});return!1});if(a.paginateOnScroll){var h=d(window),m=d(document);h.scroll(function(){if(m.height()-h.height()-h.scrollTop()<=a.paginateOnScrollMargin){var b=a.paginateOnScrollChunkSize;(!b||g%b)&&c.find(a.moreSelector).click()}})}c.on("click",
a.pagesSelector,function(){var b=d(this),c=b.get(0),e=k(b);!1!==a.onClick.apply(c,[e])&&b.closest(a.pageSelector).load(e.url,"querystring_key="+e.key,function(b){a.onCompleted.apply(c,[e,b.trim()])});return!1})})};d.endlessPaginate=function(c){return d("body").endlessPaginate(c)}})(jQuery);